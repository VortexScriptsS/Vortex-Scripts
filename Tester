local VortexUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/VortexScriptsS/Vortex-Scripts/refs/heads/main/VortexUI"))()

-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Player references
local player = Players.LocalPlayer
local character = player.Character or player:WaitForChild("Character")

VortexUI:CreateWindow({
    Name = "Vortex Client",
    KeySystem = {
        ValidKeys = {"ilikechicken"}
    },
    OnWindowCreated = function(Window)
        if Window then
            -- Create tabs
            local PlayerTab = Window:CreateTab({
                Name = "Player",
                Icon = "user"
            })
            
            local CollectTab = Window:CreateTab({
                Name = "Farm",
                Icon = "shovel"
            })

            local TeleportTab = Window:CreateTab({
                Name = "Teleport",
                Icon = "map"
            })
            
            -- Player tab variables
            local walkSpeedEnabled = false
            local walkSpeedValue = 24
            
            -- Walkspeed toggle
            PlayerTab:CreateToggle({
                Name = "Enable Walkspeed",
                CurrentValue = false,
                Flag = "EnableWalkspeed",
                Callback = function(value)
                    walkSpeedEnabled = value
                    if value then
                        task.spawn(function()
                            while walkSpeedEnabled do
                                local currentChar = player.Character or player:WaitForChild("Character")
                                if currentChar and currentChar:FindFirstChild("Humanoid") then
                                    currentChar.Humanoid.WalkSpeed = walkSpeedValue
                                end
                                task.wait(0.1)
                            end
                        end)
                    end
                end
            })
            
            -- Walkspeed slider
            PlayerTab:CreateSlider({
                Name = "Walkspeed Value",
                Range = {24, 100},
                Increment = 1,
                CurrentValue = 24,
                Flag = "WalkspeedValue",
                Callback = function(value)
                    walkSpeedValue = value
                end
            })
            
            -- Collect tab variables
            local autoCollectEnabled = false
            local collectRemote = ReplicatedStorage:WaitForChild("Events"):WaitForChild("ToolCollect")
            
            -- Auto collect toggle
            CollectTab:CreateToggle({
                Name = "Auto Collect",
                CurrentValue = false,
                Flag = "EnableAutoCollect",
                Callback = function(value)
                    autoCollectEnabled = value
                    if value then
                        task.spawn(function()
                            while autoCollectEnabled do
                                collectRemote:FireServer()
                                task.wait(0.1)
                            end
                        end)
                    end
                end
            })


            -- Auto farm section
            CollectTab:CreateSection("Auto Farm")

            -- Auto farm variables
            local autoFarmEnabled = false
            local selectedZone = nil
            local atHive = false
            local atZone = false

            -- Get zones safely
            local Zones = workspace:FindFirstChild("FlowerZones")
            if not Zones then
                warn("FlowerZones not found in workspace!")
                return
            end

            -- Initialize selected zone
            selectedZone = Zones:GetChildren()[1]
            if not selectedZone then
                warn("No zones found in FlowerZones!")
                return
            end

            -- Dropdown for selecting zone
            local zoneNames = {}
            for _, zone in ipairs(Zones:GetChildren()) do
                table.insert(zoneNames, zone.Name)
            end

            CollectTab:CreateDropdown({
                Name = "Select Zone",
                Options = zoneNames,
                CurrentOption = selectedZone.Name,
                Tooltip = "Select which flower zone to farm",
                Callback = function(option)
                    for _, zone in ipairs(Zones:GetChildren()) do
                        if zone.Name == option then
                            selectedZone = zone
                            break
                        end
                    end
                end
            })

            -- Get current pollen collected safely
            local function GetPollenCollected()
                local success, result = pcall(function()
                    local pollenGui = player:WaitForChild("PlayerGui"):FindFirstChild("ScreenGui")
                    if not pollenGui then return 0, 0 end
                    
                    local meterHUD = pollenGui:FindFirstChild("MeterHUD")
                    if not meterHUD then return 0, 0 end
                    
                    local pollenMeter = meterHUD:FindFirstChild("PollenMeter")
                    if not pollenMeter then return 0, 0 end
                    
                    local bar = pollenMeter:FindFirstChild("Bar")
                    if not bar then return 0, 0 end
                    
                    local textLabel = bar:FindFirstChild("TextLabel")
                    if not textLabel then return 0, 0 end
                    
                    local text = textLabel.Text:gsub(",", "")
                    local collected, max = text:match("(%d+)/(%d+)")
                    return tonumber(collected) or 0, tonumber(max) or 0
                end)
                
                if success then
                    return result
                else
                    warn("Error getting pollen: " .. tostring(result))
                    return 0, 0
                end
            end

            -- Walk to a position smoothly
            local function WalkTo(targetPos, speed)
                speed = speed or 16
                local currentChar = player.Character or player:WaitForChild("Character")
                local hrp = currentChar:WaitForChild("HumanoidRootPart")
                
                local startTime = tick()
                local timeout = 10 -- 10 second timeout
                
                while (hrp.Position - targetPos).magnitude > 2 do
                    if tick() - startTime > timeout then
                        warn("WalkTo timeout reached")
                        break
                    end
                    
                    local direction = (targetPos - hrp.Position).unit
                    hrp.CFrame = CFrame.new(hrp.Position + direction * speed * 0.016) -- 60fps approximation
                    task.wait()
                end
            end

            -- Get hive position safely
            local function GetHiveCFrame()
                local success, result = pcall(function()
                    return player.SpawnPos.Value
                end)
                
                if success and result then
                    return result
                else
                    -- Fallback to character position if SpawnPos doesn't work
                    local currentChar = player.Character or player:WaitForChild("Character")
                    return currentChar:WaitForChild("HumanoidRootPart").CFrame
                end
            end

            -- Get flowers in selected zone
            local function GetFlowersInZone(zone)
                if not zone then return {} end
                
                local flowers = {}
                for _, child in ipairs(zone:GetDescendants()) do
                    if child:IsA("BasePart") and (child.Name:lower():find("flower") or child.Name:lower():find("pollen")) then
                        table.insert(flowers, child)
                    end
                end
                
                return flowers
            end

            -- Main auto-farm loop
            task.spawn(function()
                while true do
                    if autoFarmEnabled and selectedZone then
                        local collected, max = GetPollenCollected()
                        local currentChar = player.Character or player:WaitForChild("Character")
                        local hrp = currentChar:WaitForChild("HumanoidRootPart")
                        
                        if not collected or not max then
                            warn("Failed to get pollen values")
                            task.wait(1)
                        elseif collected < max then
                            if not atZone then
                                print("Moving to zone: " .. selectedZone.Name)
                                atZone = true
                                atHive = false
                            end

                            -- Get flowers in the selected zone
                            local flowers = GetFlowersInZone(selectedZone)
                            if #flowers > 0 then
                                for _, flower in ipairs(flowers) do
                                    if collected >= max or not autoFarmEnabled then break end
                                    WalkTo(flower.Position)
                                    makeHoneyRemote:FireServer("ToggleHoneyMaking")
                                    task.wait(0.1)
                                    collected, _ = GetPollenCollected()
                                end
                            else
                                warn("No flowers found in zone: " .. selectedZone.Name)
                            end

                        elseif collected >= max then
                            if not atHive then
                                print("Returning to hive")
                                local hiveCFrame = GetHiveCFrame()
                                hrp.CFrame = hiveCFrame
                                atHive = true
                                atZone = false
                                task.wait(1)
                                makeHoneyRemote:FireServer("ToggleHoneyMaking")

                                -- Wait until pollen resets
                                repeat
                                    task.wait(1)
                                    collected, _ = GetPollenCollected()
                                until collected == 0

                                task.wait(0.5)
                            end
                        end
                    end
                    task.wait(1)
                end
            end)

            -- GUI toggle
            CollectTab:CreateToggle({
                Name = "Toggle Autofarm",
                CurrentValue = false,
                Callback = function(value)
                    autoFarmEnabled = value
                    print("Auto-farm " .. (value and "enabled" or "disabled"))
                    if value then
                        -- Reset location tracking when enabling
                        atHive = false
                        atZone = false
                    end
                end
            })

            local collectables = workspace.Collectibles
            local royalJellyList = {}
            
            local function updateRoyalJellyList()
                royalJellyList = {}
                for _, collectible in ipairs(collectables:GetChildren()) do
                    if collectible:FindFirstChild("FrontDecal") and 
                       collectible.FrontDecal.Texture == "rbxassetid://1471882621" and
                       collectible.Transparency <= 0 then
                        table.insert(royalJellyList, collectible)
                    end
                end
            end
            
            -- Initial scan
            updateRoyalJellyList()
            
            -- Update list periodically
            task.spawn(function()
                while true do
                    updateRoyalJellyList()
                    task.wait(2)
                end
            end)

            TeleportTab:CreateToggle({
                Name = "Collect Royal Jelly",
                CurrentValue = false,
                Callback = function(value)
                    if value then
                        local collectLoop
                        collectLoop = task.spawn(function()
                            while value do
                                if #royalJellyList > 0 then
                                    -- Find nearest royal jelly
                                    local nearestJelly = nil
                                    local nearestDistance = math.huge
                                    local currentChar = player.Character or player:WaitForChild("Character")
                                    local hrp = currentChar:WaitForChild("HumanoidRootPart")
                                    local playerPos = hrp.Position
                                    
                                    for _, jelly in ipairs(royalJellyList) do
                                        if jelly and jelly.Parent then
                                            local distance = (jelly.Position - playerPos).Magnitude
                                            if distance < nearestDistance then
                                                nearestDistance = distance
                                                nearestJelly = jelly
                                            end
                                        end
                                    end
                                    
                                    if nearestJelly then
                                        hrp.CFrame = CFrame.new(nearestJelly.Position + Vector3.new(0, 3, 0))
                                        task.wait(0.5)
                                    else
                                        -- No royal jelly found, wait and refresh list
                                        updateRoyalJellyList()
                                        task.wait(2)
                                    end
                                else
                                    -- No royal jelly in list, wait and refresh
                                    updateRoyalJellyList()
                                    task.wait(2)
                                end
                                task.wait(0.1)
                            end
                        end)
                        
                        -- Store the loop so we can stop it later
                        TeleportTab.royalJellyLoop = collectLoop
                    else
                        -- Stop the collection loop
                        if TeleportTab.royalJellyLoop then
                            task.cancel(TeleportTab.royalJellyLoop)
                            TeleportTab.royalJellyLoop = nil
                        end
                    end
                end
            })


            TeleportTab:CreateButton({
                Name = "Teleport to hive",
                Callback = function()
                    local hiveCFrame = GetHiveCFrame()
                    player.Character.HumanoidRootPart.CFrame = hiveCFrame
                end
            })
            
        end
    end
})
